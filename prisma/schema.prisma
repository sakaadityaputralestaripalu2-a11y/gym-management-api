generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      String    @default("USER") // USER atau ADMIN, nanti dicek di level aplikasi
  members   Member[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([email])
}

model Member {
  id               Int              @id @default(autoincrement())
  userId           Int?             // optional â†’ boleh null
  user             User?            @relation(fields: [userId], references: [id], onDelete: SetNull)

  fullName         String
  phoneNumber      String?
  membershipPlanId Int
  membershipPlan   MembershipPlan   @relation(fields: [membershipPlanId], references: [id], onDelete: Cascade)

  classBookings    ClassBooking[]

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@index([fullName])
  @@index([membershipPlanId])
}

model MembershipPlan {
  id             Int       @id @default(autoincrement())
  name           String
  price          Int       // rupiah
  durationInDays Int       // misal 30, 90, 365
  description    String?

  members        Member[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([name])
}

model GymClass {
  id             Int             @id @default(autoincrement())
  name           String
  description    String?
  scheduleTime   DateTime
  maxParticipants Int

  bookings       ClassBooking[]

  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@index([name])
  @@index([scheduleTime])
}

// Junction table many-to-many Member <-> GymClass
model ClassBooking {
  id         Int      @id @default(autoincrement())
  memberId   Int
  gymClassId Int
  status     String   @default("CONFIRMED") // CONFIRMED, CANCELLED, COMPLETED

  member     Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  gymClass   GymClass @relation(fields: [gymClassId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([memberId, gymClassId])
  @@index([memberId])
  @@index([gymClassId])
}
