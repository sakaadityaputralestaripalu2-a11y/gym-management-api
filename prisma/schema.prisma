generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      String    @default("USER") // USER | ADMIN
  members   Member[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([email])
}

model MembershipPlan {
  id             Int       @id @default(autoincrement())
  name           String
  price          Int
  durationInDays Int
  description    String?

  members        Member[]

  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([name])
}

model Member {
  id               Int              @id @default(autoincrement())
  userId           Int?             // optional owner, can be null
  user             User?            @relation(fields: [userId], references: [id], onDelete: SetNull)

  fullName         String
  email            String?          @unique
  phoneNumber      String?
  membershipPlanId Int
  membershipPlan   MembershipPlan   @relation(fields: [membershipPlanId], references: [id], onDelete: Cascade)

  bookings         ClassBooking[]

  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@index([fullName])
  @@index([membershipPlanId])
}

model GymClass {
  id              Int            @id @default(autoincrement())
  name            String
  description     String?
  scheduleTime    DateTime
  maxParticipants Int

  bookings        ClassBooking[]

  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([name])
  @@index([scheduleTime])
}

model ClassBooking {
  id         Int      @id @default(autoincrement())
  memberId   Int
  gymClassId Int
  status     String   @default("CONFIRMED") // CONFIRMED | CANCELLED | COMPLETED

  member     Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  gymClass   GymClass @relation(fields: [gymClassId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([memberId, gymClassId])
  @@index([memberId])
  @@index([gymClassId])
}
